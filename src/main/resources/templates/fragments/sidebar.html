<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="sidebar">
    <!-- Search Box -->
    <div class="card mb-4 sidebar-card">
        <div class="card-body">
            <h5 class="card-title">جستجو</h5>
            <div class="input-group">
                <input type="text" id="search-input" class="form-control" placeholder="جستجو...">
                <button class="btn btn-primary" onclick="searchPosts(document.getElementById('search-input').value)">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Categories -->
    <div class="card mb-4 sidebar-card">
        <div class="card-body">
            <h5 class="card-title">دسته‌بندی‌ها</h5>
            <div id="categories-list">
                <!-- با JavaScript پر خواهد شد -->
            </div>
        </div>
    </div>

    <!-- Recent Posts -->
    <div class="card mb-4 sidebar-card">
        <div class="card-body">
            <h5 class="card-title">پست‌های اخیر</h5>
            <div id="recent-posts">
                <!-- با JavaScript پر خواهد شد -->
            </div>
        </div>
    </div>

    <script>
        // بارگذاری دسته‌بندی‌ها
        async function loadCategories() {
            try {
                const response = await fetch('/api/categories');
                if (response.ok) {
                    const categories = await response.json();
                    const categoriesList = document.getElementById('categories-list');

                    let categoriesHTML = '';
                    categories.forEach(category => {
                        categoriesHTML += `
                            <div class="mb-2">
                                <a href="/categories/${category.slug}" class="text-decoration-none">
                                    ${category.name}
                                </a>
                                <span class="text-muted">(${category.postCount || 0})</span>
                            </div>
                        `;
                    });

                    categoriesList.innerHTML = categoriesHTML;
                }
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // بارگذاری پست‌های اخیر
        async function loadRecentPosts() {
            try {
                const response = await fetch('/api/posts/recent?limit=5');
                if (response.ok) {
                    const posts = await response.json();
                    const recentPosts = document.getElementById('recent-posts');

                    let postsHTML = '';
                    posts.forEach(post => {
                        const postDate = new Date(post.createdAt).toLocaleDateString('fa-IR');
                        postsHTML += `
                            <div class="mb-3">
                                <h6>
                                    <a href="/posts/${post.id}" class="text-decoration-none">
                                        ${post.title}
                                    </a>
                                </h6>
                                <small class="text-muted">${postDate}</small>
                            </div>
                        `;
                    });

                    recentPosts.innerHTML = postsHTML;
                }
            } catch (error) {
                console.error('Error loading recent posts:', error);
            }
        }

        // بارگذاری داده‌های sidebar
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            loadRecentPosts();
        });
    </script>
</div>
</html>